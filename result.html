<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculation Result</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <style>
    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #ffffff;
      font-family: 'Californian FB', serif;

      margin: 0;
      padding: 20px;
      color: #333;
      background-image: radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 20px 20px;
    }

    .result-container {
      background: transparent;
      backdrop-filter: none;
      border-radius: 0;
      padding: 2rem 1rem;
      box-shadow: none;
      max-width: 1000px;
      width: 100%;
      text-align: center;
      transition: none;
    }
    .result-container:hover {
    }

    h1 {
      font-weight: 800;
      font-size: 2rem;
      margin-bottom: 2rem;
      color: #3b3063;
    }

    .result-box {
      background: #f4f6fc;
      border-radius: 0.75rem;
      padding: 1.5rem 2rem;
      font-size: 1.25rem;
      font-weight: 600;
      color: #4a4a4a;
      box-shadow: inset 0 0 15px #c1c7f0;
      margin-bottom: 2.5rem;
      user-select: text;
    }

    a.btn {
      background: #667eea;
      color: white;
      font-weight: 700;
      padding: 0.9rem 1.5rem;
      border-radius: 0.75rem;
      text-decoration: none;
      display: inline-block;
      box-shadow: 0 8px 15px rgba(102, 126, 234, 0.4);
      transition: background 0.3s ease, box-shadow 0.3s ease;
    }

    a.btn:hover {
      background: #5a6ddf;
      box-shadow: 0 12px 25px rgba(90, 109, 223, 0.6);
      text-decoration: none;
      color: white;
    }
  .stars-bg {
    background:
      radial-gradient(2px 2px at 20% 30%, rgba(255,255,255,0.25) 50%, transparent 51%) repeat,
      radial-gradient(1.5px 1.5px at 70% 80%, rgba(255,255,255,0.25) 50%, transparent 51%) repeat,
      radial-gradient(1px 1px at 40% 60%, rgba(255,255,255,0.25) 50%, transparent 51%) repeat,
      linear-gradient(135deg, #0f1130, #1b1f5c, #2a2f7a);
    background-size: 120px 120px, 180px 180px, 240px 240px, cover;
    animation: twinkle 10s infinite linear;
  }

  @keyframes twinkle {
    0% { background-position: 0 0, 0 0, 0 0, 0 0; }
    100% { background-position: 120px 0, 0 180px, -240px 0, 0 0; }
  }
  canvas { display:block; width:100%; max-width:100%; border-radius: 0.5rem; background: #0f1130; }
  .viz { margin-bottom: 1rem; }
  .viz-grid { display:grid; grid-template-columns: 1fr 1fr; gap: 1rem; align-items: start; }
  @media (max-width: 900px) { .viz-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body class="stars-bg">
  <main class="result-container" role="main">
    <h1>CALCULATION RESULT</h1>
    <div class="result-box" id="resultBox" aria-live="polite">
      Loading...
    </div>

    <div id="visualizationSection" style="display: none;">
      <div class="viz-grid">
        <div class="viz">
          <canvas id="impactCanvas" width="640" height="360" aria-label="Asteroid impact animation"></canvas>
        </div>
        <div class="viz" style="height:300px">
          <canvas id="effectsChart" aria-label="Impact effects horizontal bar chart"></canvas>
        </div>
      </div>

      <div id="insightsSection" class="text-start" style="background:#ffffff; border-radius:0.75rem; padding:1rem; box-shadow:0 6px 18px rgba(0,0,0,0.08); margin: 0.5rem 0 1rem 0; color:#3b3063;">
        <h2 style="font-size:1.1rem; font-weight:800; margin:0 0 0.5rem 0;">Why some effects look larger</h2>
        <ul id="insightsList" style="margin:0; padding-left:1.2rem;">
        </ul>
      </div>
    </div>

    <a href="index.html" class="btn">Try Another Calculation</a>
  </main>
  <script src="static/calculations.js"></script>
  <script>
    // Wait for calculations.js to load
    window.addEventListener('DOMContentLoaded', function() {
      // Get data from sessionStorage
      const result = sessionStorage.getItem('result');
      const metricsStr = sessionStorage.getItem('metrics');
      const insightsStr = sessionStorage.getItem('insights');
      
      console.log('Result:', result);
      console.log('Metrics:', metricsStr);
      
      if (!result || !metricsStr) {
        // Redirect to index if no data (e.g., direct access)
        document.getElementById('resultBox').textContent = 'No calculation data found. Please go back and calculate first.';
        setTimeout(function() {
          window.location.href = 'index.html';
        }, 2000);
        return;
      }
      
      try {
        const metrics = JSON.parse(metricsStr);
        const insights = JSON.parse(insightsStr || '[]');
        
        // Display result
        document.getElementById('resultBox').textContent = result;
        
        // Show visualization if metrics exist
        if (metrics) {
          document.getElementById('visualizationSection').style.display = 'block';
          
          // Set metrics data for impact.js
          const metricsDataEl = document.createElement('script');
          metricsDataEl.id = 'metrics-data';
          metricsDataEl.type = 'application/json';
          metricsDataEl.textContent = JSON.stringify(metrics);
          document.body.appendChild(metricsDataEl);
          
          // Display insights
          if (insights && insights.length > 0) {
            const insightsList = document.getElementById('insightsList');
            insightsList.innerHTML = ''; // Clear any existing items
            insights.forEach(tip => {
              const li = document.createElement('li');
              li.style.margin = '0.25rem 0';
              li.textContent = tip;
              insightsList.appendChild(li);
            });
          } else {
            document.getElementById('insightsSection').style.display = 'none';
          }
          
          // Load Chart.js first
          if (!window.Chart) {
            const chartScript = document.createElement('script');
            chartScript.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js';
            chartScript.onerror = function() {
              console.error('Failed to load Chart.js');
              document.getElementById('resultBox').textContent += ' (Chart library failed to load. Please check your internet connection.)';
            };
            document.body.appendChild(chartScript);
            
            chartScript.onload = function() {
              console.log('Chart.js loaded');
              loadImpactScript();
            };
          } else {
            loadImpactScript();
          }
        }
      } catch (error) {
        console.error('Error loading result page:', error);
        document.getElementById('resultBox').textContent = 'Error loading results: ' + error.message + '. Please try again.';
      }
      
      function loadImpactScript() {
        const impactScript = document.createElement('script');
        impactScript.src = 'static/impact.js';
        impactScript.onerror = function() {
          console.error('Failed to load impact.js');
          document.getElementById('resultBox').textContent += ' (Animation script failed to load.)';
        };
        impactScript.onload = function() {
          console.log('impact.js loaded');
        };
        document.body.appendChild(impactScript);
      }
    });
  </script>
</body>
</html>

